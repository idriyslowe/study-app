<%= render partial: "navbar" %>

<div class="wrapper">
<!-- ANGULAR AND BOOTSTRAP SETUP -->
  <div ng-app="app">
    <div ng-controller="notes" ng-init="setup()">
      <section class="module-accordion">
        <div class="container-fluid container-custom" ng-repeat="note in notes">
          <div class="col-sm-12 tags font-serif"> 
            <div class="row">
            <!-- END SETUP -->
            <!-- BOOKMARKS -->
            <div class="col-md-12">
              <a href="/bookmarks/{{marks.bookmark.id}}" target="_blank" ng-repeat="marks in note.bookmarks">{{marks.bookmark.id}}{{marks.bookmark.name}}</a>
            </div>
            <!-- BOOKMARKS -->
              <div class="col-md-10">
                <!-- NOTE ACCORDIONS -->
                <div id="accordion" class="panel-group">               
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#support{{note.id}}">
                      {{ note.id }}  {{ note.text}}                         
                      </a></h4>
                    </div>
                    <div id="support{{note.id}}" class="panel-collapse collapse">
                      <div class="panel-body">
                      
                        <textarea name="text" id="text" ng-model="noteText "></textarea>
                        <div>
                          <button class="btn btn-block btn-round btn-dark" ng-click="editNote(noteText, note)">Update Note</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              <!-- END ACCORDIONS --> 
              </div>
              <!-- DELETE BUTTONS -->
              <div class="col-md-2">
                <a ng-click="deleteNote(note)" href="#">Delete</a>
              </div>
              <div class="col-md-2">
                <a href="javascript:alert('Hi');">Click Me!</a>
              </div>
              <!-- END BUTTONS -->
            </div>      
        </div>
      </div>
      </section>
    </div>
  </div>

  <div class="notepage-buttons-and-comments">
    <!-- NEW NOTE BUTTON -->
    <div class="row">
      <div class="col-sm-10">
        <%= form_tag '/api/notes', method: :post do %>
        <%= hidden_field_tag :note_page_id, @note_pages.id %> 
            <div class="text-center">
              <button type="submit" class="btn btn-block btn-round btn-dark">New Note</button>
            </div>
        <% end %>
      </div>
      <!-- BUTTON END -->
      <!-- BACK TO ENV BUTTON -->
      <div class="col-sm-2 tags font-serif"> 
        <%= link_to 'Back to Environment', "/environments/#{@note_pages.environment_id}" %>
      </div> 
      <!-- END BUTTON -->
    </div>    
    <div class="row">
    <!-- UNASSIGNED BOOKMARKS -->
      <div class="col-sm-10 tags font-serif">
        <h3>Unassigned Bookmarks</h3>
        <% current_user.unassigned_bookmarks.each do |bookmark| %>
          <%= link_to "#{bookmark.id} #{bookmark.name}", "/bookmarks/#{bookmark.id}", target: "_blank" %>
        <% end %>
      </div> 
    <!-- END /UNASSIGNED BOOKMARKS -->
    </div>
        <!-- COMMENTS SECTION -->
      <div class="row">
        <div class="col-sm-10">
          <% @note_pages.comments.each do |comment| %>
            <p><%= comment.user.handle %>   <%= comment.readable_created_at %>   <%= link_to 'Delete', "/comments/#{comment.id}", method: :delete %></p>
            <p><%= comment.text %></p>
            <hr>
          <% end %>
          <%= form_tag '/comments', method: :post do %>
            <%= text_area_tag :text, "..." %>
            <%= hidden_field_tag :note_page_id, @note_pages.id %>
             <div class="text-center">
               <button type="submit" class="btn btn-block btn-round btn-dark">Submit Comment
               </button>
             </div>
          <% end %>
        </div>    
      </div>
    </div>
  </div>
</div>
